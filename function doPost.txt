function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const data = JSON.parse(e.postData.contents);
    
    sheet.appendRow([
      new Date(),
      data.name || '',
      data.fatherName || '',
      data.phone || '',
      data.gender || '',
      data.subject || '',
      data.day || '',
      data.hours || '',
      data.time || '',
      data.trial || '',
      data.location || '',
      data.nation || '',
      data.checkboxConfirmed ? 'Yes' : 'No'
    ]);
    
    return ContentService.createTextOutput("Success");
  } catch (error) {
    return ContentService.createTextOutput("Error: " + error.toString());
  }
}



// new 

function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName("Ilm-e Deen Academy Student Entry List");
    
    if (!sheet) {
      sheet = ss.getActiveSheet();
    }
    
    const data = JSON.parse(e.postData.contents);
    const timestamp = new Date();

    sheet.appendRow([
      timestamp,
      data.name,
      data.fatherName,
      data.phone,
      data.gender,
      data.subject,
      data.day,
      data.hours,
      data.time,
      data.trial,
      data.location,
      data.nation,
      data.checkboxConfirmed
    ]);

    const htmlBody = `
    <h2>ЁЯУе ржирждрзБржи рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи - Ilm-e Deen Academy</h2>
    <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; font-family: Arial, sans-serif;">
      <tr style="background-color: #f2f2f2;">
        <td><strong>Field</strong></td>
        <td><strong>Value</strong></td>
      </tr>
      <tr>
        <td>ЁЯСд ржкрзВрж░рзНржг ржирж╛ржо:</td>
        <td>${data.name}</td>
      </tr>
      <tr>
        <td>ЁЯСитАНЁЯСз ржкрж┐рждрж╛рж░ ржирж╛ржо:</td>
        <td>${data.fatherName}</td>
      </tr>
      <tr>
        <td>ЁЯУ▒ рж╣рзЛрзЯрж╛ржЯрж╕ржЕрзНржпрж╛ржк ржирж╛ржорзНржмрж╛рж░:</td>
        <td>${data.phone}</td>
      </tr>
      <tr>
        <td>тЪз рж▓рж┐ржЩрзНржЧ:</td>
        <td>${data.gender}</td>
      </tr>
      <tr>
        <td>ЁЯУЪ ржпрзЗ ржХрзЛржи ржмрж┐рж╖рзЯрзЗ ржкрзЬрждрзЗ ржЗржЪрзНржЫрзБржХ:</td>
        <td>${data.subject}</td>
      </tr>
      <tr>
        <td>ЁЯУЖ рж╕ржкрзНрждрж╛рж╣рзЗ ржпрждржжрж┐ржи ржХрзНрж▓рж╛рж╕ ржХрж░рждрзЗ ржЪрж╛ржи:</td>
        <td>${data.day}</td>
      </tr>
      <tr>
        <td>тП░ ржкрзНрж░рждрж┐ржжрж┐ржи ржпржд ржШржгрзНржЯрж╛ ржкрзЬрждрзЗ ржЪрж╛ржи:</td>
        <td>${data.hours}</td>
      </tr>
      <tr>
        <td>ЁЯХТ ржкржЫржирзНржжрзЗрж░ рж╕ржорзЯрж╕рзВржЪрж┐:</td>
        <td>${data.time || 'Not specified'}</td>
      </tr>
      <tr>
        <td>ЁЯОУ ржлрзНрж░рж┐ ржЯрзНрж░рж╛рзЯрж╛рж▓ ржХрзНрж▓рж╛рж╕ ржирж┐рждрзЗ ржЪрж╛ржи ржХрж┐ржирж╛?</td>
        <td>${data.trial}</td>
      </tr>
      <tr>
        <td>ЁЯМН ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи:</td>
        <td>${data.location || 'Not specified'}</td>
      </tr>
      <tr>
        <td>ЁЯП│я╕П ржЬрж╛рждрзАрзЯрждрж╛:</td>
        <td>${data.nation}</td>
      </tr>
      <tr>
        <td>тЬЕ "рж╣рзЛрзЯрж╛ржЯрж╕ржЕрзНржпрж╛ржк ржирж╛ржорзНржмрж╛рж░ржЯрж┐" рж╕ржарж┐ржХ ржХрж┐ржирж╛?</td>
        <td>${data.checkboxConfirmed ? 'Yes' : 'No'}</td>
      </tr>
      <tr>
        <td>ЁЯУЕ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржирзЗрж░ рж╕ржорзЯрж╕рзВржЪрзА:</td>
        <td>${timestamp.toLocaleString()}</td>
      </tr>
    </table>
    `;

const recipients = [
  "fahimahmad123go@gmail.com",
  "abdurrahman123go@gmail.com",
  "fahimabdurrahman.uimc.b3@gmail.com"
];

MailApp.sendEmail({
  to: recipients.join(","),
  subject: "ЁЯУе ржирждрзБржи рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи - Ilm-e Deen Academy",
  htmlBody: htmlBody
});

    return ContentService.createTextOutput("Success");

  } catch (error) {
    return ContentService.createTextOutput("Error: " + error.toString());
  }
}
